ТЗ на разработку
Автоматизированной системы уведомлений штабов Министерства энергетики (АСУ-Оповещение)
⸻
1. Общие сведения
1.1. Наименование системы
Автоматизированная система уведомления участников штабов Министерства энергетики — АСУ-Оповещение.
1.2. Основание для разработки
Необходимость в своевременном массовом уведомлении участников штабов о заседаниях, событиях, поручениях и других мероприятиях, включая:
	•	SMS-уведомления,
	•	отслеживание статусов отправки.
1.3. Цель разработки
Создание удобного веб-интерфейса на позволяющего оператору эффективно управлять процессом уведомления сотрудников штабов Министерства.
1.4. Назначение разработки
Система предназначена для оператора, который вручную получает задачи от руководства и обязан оперативно уведомить участников штабов.
⸻
2. Требования к системе
2.1. Функциональные требования
2.1.1. Управление участниками
Система должна предоставлять возможность:
	1.	Добавлять нового участника с полями:
	•	ФИО
	•	Номер телефона
	•	Должность (опционально)
	2.	Удалять участника
	3.	Редактировать данные участника

1.2. Управление штабами
Система должна позволять:
	1.	Создавать штаб (группу)
	2.	Удалять штаб (группу)
	3.	Редактировать название штаба
	4.	Добавлять и удалять участников в штаб
	5.	Выполнять действия по группе:
	6.	массовая рассылка
	7. 	индивидуальный рассылка
	8.	Настраивать шаблоны сообщений для конкретного штаба
	9. 	Экспортировать участников из MS Excel
⸻
2.1.3. Отправка уведомлений
Система должна обеспечивать:
А) SMS-уведомления
	•	Отправка SMS одному участнику
	•	Массовая отправка SMS группе
	•	Планирование SMS по дате и времени
	•	Ввод текста сообщениядля рассылки
	•	Получение статуса:
	•	отправлено
	•	в процессе
	•	ошибка
В) Настройки уведомлений
	•	Ввод текста вручную
	•	Планирование:
	•	время
	•	дата
2.1.4. Статусы и контроль доставки
Для каждого участника должны отображаться:
	•	статус последнего уведомления,
	•	дата и время отправки,
Статусы
Цвет	Статус	Описание
зелёный	доставлено	SMS отправлено 
оранжевый	в процессе	SMS отправляется 
красный	ошибка	не удалось отправить
серый	запланировано	ожидает выполнения
Система должна обновлять статусы автоматически, через периодический запрос к серверу (каждые 10 секунд).
2.1.5. Журнал событий (лог)
Система должна вести журнал:
	•	дата и время операции
	•	участник
	•	штаб
	•	текст уведомления
	•	результат доставки
	•	ошибка (если есть)
	•	API response
Журнал должен быть доступен в интерфейсе, с фильтрами.
2.1.6. Планирование уведомлений
Система должна поддерживать:
	•	планирование для отдельного участника,
	•	планирование для группы,
Параметры задания:
	•	текст сообщения
	•	дата/время
2.1.7. Системный статус (индикатор состояния)
В правой части интерфейса должно отображаться текущее действие системы:
Примеры:
	•	«Статус: отправляется SMS участнику (Иванов И.И.)»
2.2. Интерфейсные требования

2.2.1. Главная страница (Dashboard)
Содержит:
Левая панель (список штабов):
	•	список штабов
	•	кнопка «Добавить штаб»
	•	индикатор количества участников
Центральный блок:
	•	приветствие/информация
	•	статистика (опционально)
	•	журнал (краткий)
Верхняя панель:
	•	логотип
2.2.3. Интерфейс штаба
Когда оператор выбирает конкретный штаб, открывается интерфейс:
Верхняя панель:
	•	Название штаба
	•	Кнопки:
	•	Добавить участника

	•	Импорт Excel
	•	Массовая рассылка
	•	Планирование
	•	Настройки штаба
Основная таблица участников:
| Чекбокс | ФИО | Телефон | Статус | Тип уведомления | Последнее уведомление | Действия |
Действия:
	•	Отправить SMS
	•	Запланировать SMS
	•	Редактировать SMS
	•	Удалить
Справа — информационная панель:
	•	Статус системы
	•	Логи последних отправок
	•	Статистика штаба:
	•	Всего участников
	•	Доставлено
	•	Ошибка
	•	Запланировано
2.2.4. Окно массовой рассылки
Содержит:
	•	поле текста
	•	параметры планирования
	•	кнопка отправить
	•	кнопка запланировать
2.2.5. Окно индивидуального уведомления
Содержит:
	•	данные участника
	•	поле текста
	•	кнопка отправить
	•	кнопка запланировать
2.3. Требования к архитектуре
2.3.1. Технологический стек
	•	React + Express

3. Требования к интеграции с внешним API
3.1. Функции API
Система должна использовать внешний API для:
	•	отправки SMS
	•	получения статуса
API сервиса:
https://lk.sms-prosto.ru/help.php?faq=43#kak-vkluchit-api 

API KEY: txXgmflINsI4NYyNoS06937db087947a020f2bc42183f338a20002e9bc017ad0 3.2. 

Формат обмена
	•	Запросы → JSON
	•	Ответы ← JSON
⸻
4. Требования к надёжности
	•	при ошибке отправки должна быть возможна повторная попытка;


Описание API:

Отправка SMS (метод push_msg)
Отправка SMS сообщений
Для быстрого перехода используйте содержание:

1. Как включить API-шлюз.
2. Список всех параметров и их описание.
3. Пример HTTP запроса, который можно выполнить в браузере.
4. Примеры ответов сервера.
5. Коды ошибок.




Вызов методов осуществляется посредством GET или POST HTTP-запросов к любому серверу:
Адрес сервера: http://api.sms-prosto.ru
Порт (протокол): 80 (HTTP)
Метод: GET или POST
Кодировка для запроса: UTF-8	Адрес сервера: ssl.bs00.ru  
Порт (протокол): 443 (HTTPS)
Метод: GET или POST
Кодировка для запроса: UTF-8



В GET- или POST-переменных запроса передаются аргументы с именами:
Аргументы:
method - вызываемый метод.
- набор переменных, зависящий от конкретного метода (см. таблицу ниже).
format - (необязательный) формат выходных данных (XML, JSON), без указания этого параметра, по умолчанию данные выдаются в формате XML.


Все методы возвращают массив аргументов с именами:

msg - сообщение о выполнении действия в виде массива с ключами:
err_code - числовой код ошибки (0 - нет ошибок),
text - текстовое сообщение,
type - тип сообщения (message – нет ошибок, notice и error – ошибки).
data - запрашиваемые данные в виде массива.




2 Список всех параметров
Параметр	Тип (значение)	Наличие в запросе	Описание	Пример
method	push_msg	Обязательный	Инициирует отправку SMS	method=push_msg
format	json, JSON, xml, XML	Не обязательный	Значение json запрашивает ответ в формате json, в противном случае ответ будет в XML.	format=json
email	String (логин в системе)	Обязательный, если авторизация осуществляется с помощью пары логин/пароль	Необходим для авторизации.	email=myemail@yandex.ru
password	String (пароль в системе)	Обязательный, если авторизация осуществляется с помощью пары логин/пароль	Необходим для авторизации.	password=myPassWord
key	String (получить key можно в поддержке)	Обязательный, если авторизация осуществляется с помощью key.	Необходим для авторизации. В данном варианте параметры email и password передавать не нужно.	key=Hfe8dn3SdgkdHGDer
text	String	Обязательный	Максимальная длина 11 сегментов (737 символов кирилицей, либо 1683 латиницей), длинее передавать не рекомендуется, т.к. SMS может разбится на части, либо доставка будет не полностью	text=Это текст СМС
phone	Int	Обязательный	В любом формате 7ХХХYYYххyy, 8ХХХYYYххyy, +7ХХХYYYххyy, 7(ХХХ)YYY-хх-yy и т.д.	phone=79162821111
sender_name	String (max 11)	Обязательный	Имя отправителя, максимальная длина 11 символов. Требования к отправителю. Также не забудьте согласовать свой отправитель с Мегафон и МТС, подробнее тут.
sender_name=MyBrandName
priority	Int	Не обязательный	Приоритет отправляемой СМС. Если будет не указан, по умолчанию присваивается priority=2.

Допустимые значения:
1-только для СМС кодов и одиночных уведомлений требующих мгновенной доставки (например, "Ваша машина подана, выходите.", "Введите код: 2233");

2-для быстрой доставки одиночных уведомлений (Например, "Вы записаны на прием на 15:00", "Вы отменили запись на прием");

3 - Прочие уведомления, которые рассылаются в цикле небольшому количеству абонентов (например, "Ваш заказ доставлен, не забудьте зайти на почту");

4 - Массовые рассылки (например, "У нас скидки, акции!!! Только до 31 января!").

Важно! При злоупотреблении приоритетами при отправке СМС, Ваш приоритет может быть понижен на нашей стороне.	priority=2
external_id	Int,String	Не обязательный	Любое значение, id сообщения на Вашей стороне. Уникальность этих значений не проверяется на нашей стороне. При получении статусов доставки автоматическим способом, в параметре external_id будет передано Ваше значение. Используется для более удобной идетификации сообщения на Вашей стороне.

Допустимые значения:
Int
1234567890

String, UUID
123e4567-e89b-12d3-a456-426655440000	external_id=12002457



YOUR_LOGIN - Логин в системе (Е-майл)
YOUR_PASSWORD - Пароль (получаем при регистрации в системе)
YOUR_API_KEY – API Key, который можно использовать вместо Логина и Пароля
SMS_TEXT - Текст SMS сообщения
SMS_PHONE_NUMBER_OF_THE_RECIPIENT - Номер телефона получателя SMS, в любом формате
MyBrandName - Буквенное имя отправителя




4 Примеры ответа сервера
Пример XML ответа, в случае ошибки

	/* XML */
	<response>
		<msg>
			<err_code>5</err_code>
			<text>Неизвестный метод</text>
		    <type>error</type>
		</msg>
	<data/>
	</response>

Пример JSON ответа, в случае ошибки

	/* JSON */
	{
	  "response": {
		"msg":{
		   "err_code":"5",
		   "text":"Неизвестный метод",
		   "type":"error"
		},
		"data":null
	  }
	}

Пример XML ответа, в случае успешной отправки SMS

	/* XML */
	<response>
		<msg>
			<err_code>0</err_code>
			<text>OK</text>
		    <type>message</type>
		</msg>
		<data>
			<id>21528183</id>
			<credits>0.60</credits>
		    <n_raw_sms>1</n_raw_sms>
			<sender_name>MyBrandName</sender_name>
		</data>
	</response>

Пример JSON ответа, в случае успешной отправки

	/* JSON */
   {
	"response":{
		"msg":{
			"err_code":"0",
			"text":"OK",
			"type":"message"
			},
			"data":{
				"id":21528183,
				"credits":1.78,
				"n_raw_sms":1,
				"sender_name":"MyBrandName"
			}
		}
   }




5 Коды ошибок, которые возвращает параметр err_code
Код ошибки	Тип	Описание
0	Integer	Сообщение принято для отправки
3	Integer	API на Вашем аккаунте отключено. Обратитесь в поддержку.
7	Integer	Заданы не все необходимые параметры
99	Integer	Транзакция отправки SMS не прошла
602	Integer	Пользователя не существует. Проверьте правильность логина/пароля или api key. Ошибка также может возникать в случае, если запрос осуществляется с не заявленного ip адреса.
602	Integer	SMS не существует
605	Integer	Пользователь заблокирован
607	Integer	Имя отправителя недопустимо
608	Integer	Недопустимая длина имени отправителя
609	Integer	Сотовый оператор не подключен
610	Integer	Не подключен тариф пользователю
611	Integer	Не корректно установлена стоимость SMS
617	Integer	Неверный формат номера получателя SMS
618, 622	Integer	Номер aбонента в Черном списке
620	Integer	Имя отправителя должно быть на латинице
621	Integer	В имени отправителе более 2-цифр или общая длина менее 4-х символов, что не допустимо.
623	Integer	Не достаточно средств. Пополните баланс.
624	Integer	Обнаружены запрещенные слова в тексте сообщения. Обратитесь в поддержку.
625	Integer	Не удалось определить направление отправки SMS.
626	Integer	Не удалось получить данные по API KEY.
627	Integer	Неверный API KEY. Проверьте правильность api key. Ошибка также может возникать в случае, если запрос осуществляется с не заявленного ip адреса.
628	Integer	В рамках тестирования сервиса отправка разрешена только на номер, который привязан к личному кабинету (раздел "Настройки" - "Контактная информация и общие настройки"). Заполните реквизиты компании в разделе "Настройка" - "Реквизиты компании", чтобы активировать полный функционал сервиса.
629	Integer	Превышен лимит отправки номеров в одном запросе (допускается не более 1000 номеров в запросе).
631	Integer	Сообщение отклонено. Нельзя смешивать русские и английские символы в одном слове. Сервис не принимает SMS, в которых в одном слове смешаны кириллица и латиница, т.к. операторы блокируют такие смс, воспринимая за попытку обойти СПАМ фильтр.
632	Integer	Незарегистрированный sender_name. Необходимо добавить отправитель в раздел "Отправители" в личном кабинете и в обязательном порядке подать на согласование с оператором ПАО "Мегафон".
645	Integer	Сообщение отклонено.
699	Integer	Не удалось установить соединение.







